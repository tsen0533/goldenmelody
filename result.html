<script>
const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxK7iWtoFUPUvCgNdZ5XCDjh4dbEWRTNg3G9iX0RciqIenKfOrnENeEi35ooTIurrKF/exec";

function getScoreFromUrl() {
  const params = new URLSearchParams(window.location.search);
  return parseInt(params.get('score'), 10) || 0;
}
const score = getScoreFromUrl();

// 1. 取得暱稱（可選）
const userName = prompt("請輸入你的暱稱（可留空）") || "";

// 2. 取得答案
const userAnswers = JSON.parse(localStorage.getItem("goldenmelody-answers")) || [];

// 3. 送出資料
function submitResultToSheet(name, score, answers) {
  fetch(GOOGLE_SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({
      name: name,
      score: score,
      answers: answers
    }),
    headers: {
      "Content-Type": "application/json"
    }
  }).then(r => r.json())
    .then(res => {
      console.log("已送出", res);
    });
}
submitResultToSheet(userName, score, userAnswers);

// 下面是顯示圖片的部分
const resultText = document.getElementById("resultText");
const resultImage = document.getElementById("resultImage");

if (score <= 2) {
  resultText.innerText = `🥲 猜不透的不只是他的心，還有題目（得分：${score}/9）`;
  resultImage.src = "IMG_1797.JPG";
} else if (score <= 6) {
  resultText.innerText = `🤔 瞎猜微懂，多多加油！（得分：${score}/9）`;
  resultImage.src = "IMG_1795.JPG";
} else {
  resultText.innerText = `🎉 懂哥出手了！！（得分：${score}/9）`;
  resultImage.src = "IMG_1796.JPG";
}
</script>

<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>é¦–æ³¨éŸ³çŒœæ­Œå¾—åˆ†çµæœ</title>
</head>
  <script>
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxK7iWtoFUPUvCgNdZ5XCDjh4dbEWRTNg3G9iX0RciqIenKfOrnENeEi35ooTIurrKF/exec";

    function getScoreFromUrl() {
      const params = new URLSearchParams(window.location.search);
      return parseInt(params.get('score'), 10) || 0;
    }
    const score = getScoreFromUrl();
    const userAnswers = JSON.parse(localStorage.getItem("goldenmelody-answers")) || [];

    const resultText = document.getElementById("resultText");
    const resultImage = document.getElementById("resultImage");

    if (score <= 2) {
      resultText.innerText = `ğŸ¥² çŒœä¸é€çš„ä¸åªæ˜¯ä»–çš„å¿ƒï¼Œé‚„æœ‰é¡Œç›®ï¼ˆå¾—åˆ†ï¼š${score}/9ï¼‰`;
      resultImage.src = "IMG_1797.JPG";
    } else if (score <= 6) {
      resultText.innerText = `ğŸ¤” ççŒœå¾®æ‡‚ï¼Œå¤šå¤šåŠ æ²¹ï¼ï¼ˆå¾—åˆ†ï¼š${score}/9ï¼‰`;
      resultImage.src = "IMG_1795.JPG";
    } else {
      resultText.innerText = `ğŸ‰ æ‡‚å“¥å‡ºæ‰‹äº†ï¼ï¼ï¼ˆå¾—åˆ†ï¼š${score}/9ï¼‰`;
      resultImage.src = "IMG_1796.JPG";
    }

    const submitBtn = document.getElementById('submitBtn');
    const nicknameInput = document.getElementById('nicknameInput');
    const submitStatus = document.getElementById('submitStatus');

    submitBtn.addEventListener('click', function() {
      const userName = nicknameInput.value.trim();
      submitBtn.disabled = true;
      submitStatus.innerText = "æäº¤ä¸­...";
      fetch(GOOGLE_SCRIPT_URL, {
        method: "POST",
        body: JSON.stringify({
          name: userName,
          score: score,
          answers: userAnswers
        }),
        headers: {
          "Content-Type": "application/json"
        }
      }).then(r => r.json())
        .then(res => {
          submitStatus.innerText = "é€å‡ºæˆåŠŸï¼Œè¬è¬åƒèˆ‡ï¼";
          submitBtn.disabled = false;
        })
        .catch(() => {
          submitStatus.innerText = "é€å‡ºå¤±æ•—ï¼Œè«‹å†è©¦ä¸€æ¬¡ã€‚";
          submitBtn.disabled = false;
        });
    });
  </script>
</body>
</html>
